name: Deploy to GitHub pages

on:
  push:
    branches: [ master ]

jobs:
  buildAndDeploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v2.3.1 
        with:
          persist-credentials: false

      - name: Install and Build 🔧 
        run: |
          npm install
          npm run build-github-pages

      - name: Deploy 🚀
        uses: JamesIves/github-pages-deploy-action@3.7.1
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: gh-pages
          FOLDER: docs
          CLEAN: true

      - name: Checkout gh-pages
        uses: actions/checkout@v2.3.1 
        with:
          ref: gh-pages
          persist-credentials: false
      
      - name: Rename folder
        run: git mv AngularSvgExample docs

      - name: Commit and Push
        uses: github-actions-x/commit@v2.7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          push-branch: 'gh-pages'
          commit-message: 'Rename output folder'
          force-add: 'true'
          files: docs
          name: fdub (from Action)
          email: fdub@posteo.de
